[build-system]
requires = ["setuptools>=61", "versioneer[toml]>=0.26"]
build-backend = "setuptools.build_meta"

[project]
name = "chisel4ml"
# version auto-generated by pbr from git tags
# dependencies auto-generated by pbr
authors = [
    {name = "Jure Vreca", email = "jure.vreca@ijs.si"}
]
description = "A Chisel based hardware generation library for highly quantized neural networks."
readme = {file = "README.md", content-type = "text/markdown"}
requires-python = ">=3.7"
license = { file = "LICENSE" }
classifiers = [
    "Topic :: Scientific/Engineering :: Artificial Intelligence",
    "Intended Audience :: Science/Research",
    "Operating System :: OS Independent"
]
keywords = ["Chisel", "FPGA", "quantized neural networks"]
dynamic=["version"]
dependencies = [
    "QKeras==0.9.0",
    "grpcio",
    "protobuf<=3.20.0",
    "tf2-keras-surgeon",
    "pyparsing"
]
[tool.setuptools.dynamic]
version = {attr = "chisel4ml.__version__"}

[project.optional-dependencies]
dev = [
    "tox<4",
	"tox-run-before",
	"typing-extensions",
	"flake8",
    "Flake8-pyproject",
	"pytest",
	"pytest-cov",
	"mypy",
	"mypy-protobuf",
	"mypy-extensions",
	"sphinx",
	"versioneer",
	"grpcio-tools",
	"setuptools>=61",
    "build",
    "versioneer",
    "pre_commit"
]

[tool.setuptools]
include-package-data = true

[tool.setuptools.packages.find]
where = ['.']
include = ['chisel4ml*']
exclude = ['chisel4ml.tests']
namespaces = false

[tool.pytest.ini_options]
addopts = "--cov=chisel4ml"
filterwarnings = ["ignore:::.*flatbuffers*", "ignore:::.*tensorflow*"]
testpaths = [
    "tests",
]

[tool.mypy]
mypy_path = "chisel4ml"
check_untyped_defs = true
disallow_any_generics = true
ignore_missing_imports = true
no_implicit_optional = true
show_error_codes = true
strict_equality = true
warn_redundant_casts = true
warn_return_any = true
warn_unreachable = true
warn_unused_configs = true
no_implicit_reexport = true
no_namespace_packages = true
exclude = [
      '^lbir_pb2\.py$',
      '^lbir_pb2\.pyi$',
      '^lbirpb2_grpc\.py$',
      '^services_pb2\.py$',
      '^services_pb2\.pyi$',
      '^services_pb2_grpc\.py$',
      '^server_manager\.py$',
      '^_version\.py$',
    ]

[tool.flake8]
ignore = ["E203"]
max-line-length = 88
count= true
exclude=[
    ".git",
    "__pycache__",
    "docs",
    "build",
    "dist",
    "test_run_dir",
    "venv",
    "target",
    "project",
    "AUTHORS",
    "LICENSE",
    "MANIFEST.in",
    "pyproject.toml",
    "chisel4ml/_version.py",
    "ChangeLog",
    "Makefile",
    "*.hex",
    "*.ini",
    "*.md",
    "*.txt",
    "build.sbt",
    "chisel4ml/bin",
    "chisel4ml/lbir"
]

[tool.tox]
legacy_tox_ini = """
[tox]
minversion = 3.7.0
envlist = py37, py38, py39, py310, linters, mypy
isolated_build = true

[gh-actions]
python =
    3.7:  py37
    3.8:  py38
    3.9:  py39
    3.10: py310, mypy, linters

[testenv]
usedevelop = true
run_before = make protobuf
setenv =
    PYTHONPATH = {toxinidir}
extras = dev
commands =
    pytest --basetemp={envtmpdir} tests/

[testenv:linters]
commands =
    flake8 chisel4ml tests

[testenv:mypy]
deps =
    -r{toxinidir}/requirements.txt
commands = mypy --install-types --non-interactive --namespace-packages --follow-imports=skip -p chisel4ml
"""

[tool.versioneer]
VCS = "git"
style = "pep440"
versionfile_source = "chisel4ml/_version.py"
tag_prefix = ""
parentdir_prefix = "chisel4ml-"
